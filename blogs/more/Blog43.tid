tags: blog
title: Blog43
type: application/json

{"ID":43,"author":{"ID":1835213,"email":false,"name":"BoyCook","URL":"http://craigcook.co.uk","avatar_URL":"http://1.gravatar.com/avatar/7d3208cff2559445740d8ff7481c9940?s=96&d=identicon&r=G","profile_URL":"http://en.gravatar.com/boycook"},"date":"2008-07-29T18:32:26+00:00","modified":"2013-03-03T12:26:19+00:00","title":"C# Win32 messaging with SendMessage and WM_COPYDATA","URL":"http://boycook.wordpress.com/2008/07/29/c-win32-messaging-with-sendmessage-and-wm_copydata/","short_URL":"http://wp.me/p7oJB-H","content":"<p>I had a real pain recently where I wanted to control one windows app from another. I found some useful stuff on the net, but nothing that gave an end to end solution. So here&#8217;s what I came up with.</p>\n<p>Firstly I&#8217;ll explain why this is useful. SendMessage is part of the Win32 API, and is used to send messages from one application to another. There are a set of predefined properties that the message can relate to, and these can be used to send messages to existing applications to perform all sorts of useful functions such as changing the font in notepad, or bringing a window to the fore. For more information of the wider use of the SendMessage function, have a look at:</p>\n<p><a href=\"http://www.autohotkey.com/docs/commands/PostMessage.htm\">http://www.autohotkey.com/docs/commands/PostMessage.htm</a></p>\n<p><a href=\"http://msdn.microsoft.com/en-us/library/ms644950(VS.85).aspx\">http://msdn.microsoft.com/en-us/library/ms644950(VS.85).aspx</a></p>\n<p>The main use that I&#8217;m interested in is passing a specific instruction (via a string) from one app that I&#8217;ve written, to another one that I&#8217;ve written. This way I can effectively remote control one app from another (particularly useful if you want your main application to open a pop-up, and you don&#8217;t want to worry about the pop-up&#8217;s performance affecting the main application). Let&#8217;s now have a quick look at the SendMessage function:</p>\n<p>SendMessage(int hWnd, int Msg, int wParam, int lParam)</p>\n<p>hWnd &#8211; This is the window instance id of the application you want to send a message to. This id is retrieved using the FindWindow function</p>\n<p>Msg &#8211; This is the type of message you want to send</p>\n<p>wParam &#8211; Message specific data you pass in</p>\n<p>wParam &#8211; Message specific data you pass in</p>\n<p>Also used is the FindWindow function. This is to get the relevant window id:</p>\n<p>FindWindow(String lpClassName, String lpWindowName)</p>\n<p>lpClassName -The name of the class you want</p>\n<p>lpWindowName &#8211; The name of the window that you want</p>\n<p>To send a message that is a string, you need to use the WM_DATACOPY message property. The hard part is that you cannot just send the string as a parameter across. You need to send a pointer to the memory address of the string. If you just want to send an integer as a message you can use the WM_USER message property and send it as a value without a problem.</p>\n<p>For a full example of the MessageHelper.cs class see this gist:</p>\n<p><script src=\"https://gist.github.com/BoyCook/5075907.js\"></script></p>\n<p>So now you can call the code to send a message like so:</p>\n<pre class=\"brush: csharp; title: ; notranslate\" title=\"\">\r\nMessageHelper msg = new MessageHelper();\r\nint result = 0;\r\n//First param can be null\r\nint hWnd = msg.getWindowId(null, &quot;My App Name&quot;);\r\nresult = msg.sendWindowsStringMessage(hWnd, 0, &quot;Some_String_Message&quot;);\r\n//Or for an integer message\r\nresult = msg.sendWindowsMessage(hWnd, MessageHelper.WM_USER, 123, 456);\r\n</pre>\n<p>Now all you need to do on the app that you want to receive the message is override the following function in the form class (obviously you can change what the responses are, and you&#8217;ll need to create constants for the parameters):</p>\n<pre class=\"brush: csharp; title: ; notranslate\" title=\"\">\r\nprotected override void WndProc(ref Message m)\r\n{\r\nswitch (m.Msg)\r\n{\r\ncase WM_USER:\r\nMessageBox.Show(&quot;Message recieved: &quot; + m.WParam + &quot; - &quot; + m.LParam);\r\nbreak;\r\ncase WM_COPYDATA:\r\nCOPYDATASTRUCT mystr = new COPYDATASTRUCT();\r\nType mytype = mystr.GetType();\r\nmystr = (COPYDATASTRUCT)m.GetLParam(mytype);\r\nthis.doSomethingWithMessage(mystr.lpData);\r\nbreak;\r\n}\r\nbase.WndProc(ref m);\r\n}\r\n</pre>\n","excerpt":"<p>I had a real pain recently where I wanted to control one windows app from another. I found some useful stuff on the net, but nothing that gave an end to end solution. So here&#8217;s what I came up with. &hellip; <a href=\"http://boycook.wordpress.com/2008/07/29/c-win32-messaging-with-sendmessage-and-wm_copydata/\">Continue reading <span class=\"meta-nav\">&rarr;</span></a></p>\n","slug":"c-win32-messaging-with-sendmessage-and-wm_copydata","status":"publish","password":"","parent":false,"type":"post","comments_open":true,"pings_open":true,"comment_count":12,"like_count":0,"i_like":0,"is_reblogged":0,"is_following":0,"featured_image":"","format":"standard","geo":false,"publicize_URLs":[],"tags":{"messaging":{"name":"messaging","slug":"messaging","description":"","post_count":1,"meta":{"links":{"self":"https://public-api.wordpress.com/rest/v1/sites/1763379/tags/slug:messaging","help":"https://public-api.wordpress.com/rest/v1/sites/1763379/tags/slug:messaging/help","site":"https://public-api.wordpress.com/rest/v1/sites/1763379"}}},"SendMessage":{"name":"SendMessage","slug":"sendmessage","description":"","post_count":1,"meta":{"links":{"self":"https://public-api.wordpress.com/rest/v1/sites/1763379/tags/slug:sendmessage","help":"https://public-api.wordpress.com/rest/v1/sites/1763379/tags/slug:sendmessage/help","site":"https://public-api.wordpress.com/rest/v1/sites/1763379"}}},"Win32 API":{"name":"Win32 API","slug":"win32-api","description":"","post_count":1,"meta":{"links":{"self":"https://public-api.wordpress.com/rest/v1/sites/1763379/tags/slug:win32-api","help":"https://public-api.wordpress.com/rest/v1/sites/1763379/tags/slug:win32-api/help","site":"https://public-api.wordpress.com/rest/v1/sites/1763379"}}},"windows":{"name":"windows","slug":"windows","description":"","post_count":1,"meta":{"links":{"self":"https://public-api.wordpress.com/rest/v1/sites/1763379/tags/slug:windows","help":"https://public-api.wordpress.com/rest/v1/sites/1763379/tags/slug:windows/help","site":"https://public-api.wordpress.com/rest/v1/sites/1763379"}}},"WM_COPYDATA":{"name":"WM_COPYDATA","slug":"wm_copydata","description":"","post_count":1,"meta":{"links":{"self":"https://public-api.wordpress.com/rest/v1/sites/1763379/tags/slug:wm_copydata","help":"https://public-api.wordpress.com/rest/v1/sites/1763379/tags/slug:wm_copydata/help","site":"https://public-api.wordpress.com/rest/v1/sites/1763379"}}},"WM_USER":{"name":"WM_USER","slug":"wm_user","description":"","post_count":1,"meta":{"links":{"self":"https://public-api.wordpress.com/rest/v1/sites/1763379/tags/slug:wm_user","help":"https://public-api.wordpress.com/rest/v1/sites/1763379/tags/slug:wm_user/help","site":"https://public-api.wordpress.com/rest/v1/sites/1763379"}}}},"categories":{"geeky":{"name":"geeky","slug":"geeky","description":"","post_count":2,"parent":0,"meta":{"links":{"self":"https://public-api.wordpress.com/rest/v1/sites/1763379/categories/slug:geeky","help":"https://public-api.wordpress.com/rest/v1/sites/1763379/categories/slug:geeky/help","site":"https://public-api.wordpress.com/rest/v1/sites/1763379"}}},"programming":{"name":"programming","slug":"programming","description":"","post_count":11,"parent":0,"meta":{"links":{"self":"https://public-api.wordpress.com/rest/v1/sites/1763379/categories/slug:programming","help":"https://public-api.wordpress.com/rest/v1/sites/1763379/categories/slug:programming/help","site":"https://public-api.wordpress.com/rest/v1/sites/1763379"}}}},"attachments":{},"metadata":false,"meta":{"links":{"self":"https://public-api.wordpress.com/rest/v1/sites/1763379/posts/43","help":"https://public-api.wordpress.com/rest/v1/sites/1763379/posts/43/help","site":"https://public-api.wordpress.com/rest/v1/sites/1763379","replies":"https://public-api.wordpress.com/rest/v1/sites/1763379/posts/43/replies/","likes":"https://public-api.wordpress.com/rest/v1/sites/1763379/posts/43/likes/"}}}